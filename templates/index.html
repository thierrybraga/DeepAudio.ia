{% extends 'base.html' %}
{% block title %}Home - DeepAudio{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-12 col-md-6 col-lg-4">
    <div class="card shadow h-100">
      <div class="card-body d-flex flex-column justify-content-center text-center">
        <i class="bi bi-cloud-upload display-4 text-primary"></i>
        <h5 class="card-title mt-3">Treinar Novo Modelo</h5>
        <p class="card-text">Envie um novo dataset de áudio (.zip) para treinar ou retreinar um modelo. Este processo inclui a extração de features e o treinamento do modelo.</p>
        <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" id="datasetUploadForm">
          <div class="mb-3">
            <label for="dataset_zip" class="form-label visually-hidden">Arquivo ZIP do Dataset</label>
            <input type="file" class="form-control" id="dataset_zip" name="file" accept=".zip" required aria-describedby="datasetHelp">
            <div id="datasetHelp" class="form-text">Apenas arquivos .zip são aceitos. O ZIP deve conter subpastas de áudio rotuladas (e.g., 'real/', 'fake/') ou um CSV de mapeamento na raiz.</div>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-primary" id="uploadDatasetBtn">
              <i class="bi bi-upload me-1"></i>Enviar Dataset
            </button>
          </div>
        </form>
        <hr>
        <a href="{{ url_for('train') }}" class="btn btn-outline-primary mt-auto">
          <i class="bi bi-cpu me-1"></i>Configurar e Iniciar Treinamento
        </a>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-6 col-lg-4">
    <div class="card shadow h-100">
      <div class="card-body d-flex flex-column justify-content-center text-center">
        <i class="bi bi-file-earmark-music display-4 text-success"></i>
        <h5 class="card-title mt-3">Detectar Deepfake de Áudio</h5>
        <p class="card-text">Carregue um arquivo de áudio para que o modelo detecte se é real ou gerado por IA (deepfake).</p>
        {# Formulário agora aponta para /fake_detector #}
        <form action="{{ url_for('fake_detector') }}" method="post" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="audio_file" class="form-label visually-hidden">Arquivo de Áudio</label>
            <input type="file" class="form-control" id="audio_file" name="voice_sample" accept=".wav,.mp3,.flac,.wma,.ogg" required aria-describedby="audioHelp"> {# Alterado name="file" para name="voice_sample" #}
            <div id="audioHelp" class="form-text">Formatos aceitos: WAV, MP3, FLAC, WMA, OGG.</div>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-success" {% if not model_exists %}disabled{% endif %}>
              <i class="bi bi-search me-1"></i>Detectar
            </button>
          </div>
        </form>
        {% if not model_exists %}
        <small class="text-danger mt-2">Modelo não treinado. Treine um modelo primeiro.</small>
        {% endif %}
        {# Este link agora aponta para a rota GET de fake_detector #}
        <a href="{{ url_for('fake_detector') }}" class="btn btn-outline-success mt-auto">
          <i class="bi bi-arrow-right-circle me-1"></i>Acessar Detector
        </a>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-6 col-lg-4">
    <div class="card shadow h-100">
      <div class="card-body d-flex flex-column justify-content-center text-center">
        <i class="bi bi-tools display-4 text-secondary"></i>
        <h5 class="card-title mt-3">Gerenciar Dados e Modelo</h5>
        <p class="card-text">Limpe dados temporários ou exclua o modelo treinado existente.</p>
        <div class="d-grid gap-2">
            <form action="{{ url_for('clean_data') }}" method="post">
              <button type="submit" class="btn btn-outline-secondary w-100" onclick="return confirm('Tem certeza que deseja limpar todos os dados de upload e dataset? Esta ação é irreversível.');">
                <i class="bi bi-trash me-1"></i>Limpar Dados
              </button>
            </form>
            <form action="{{ url_for('delete_model') }}" method="post">
              <button type="submit" class="btn btn-outline-danger w-100" {% if not model_exists %}disabled{% endif %} onclick="return confirm('Tem certeza que deseja excluir o modelo treinado?');">
                <i class="bi bi-trash-fill me-1"></i>Excluir Modelo
              </button>
            </form>
            {% if model_exists %}
            <span class="badge bg-success mt-2 d-flex align-items-center justify-content-center"><i class="bi bi-check-circle me-1"></i>Modelo Treinado Existente</span>
            {% else %}
            <span class="badge bg-warning mt-2 d-flex align-items-center justify-content-center"><i class="bi bi-exclamation-triangle me-1"></i>Nenhum Modelo Treinado</span>
            {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}